<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å®¶è¨ˆç®¡ç†ã‚¢ãƒ—ãƒª</title>
    <link rel="icon" href="images/favicon2.ico" type="image/x-icon">
    <link rel="apple-touch-icon" sizes="180x180" href="images/apple-touch-icon.png">
    <link rel="stylesheet" href="css/style.css">
    <script src="https://kit.fontawesome.com/77bd8a188d.js" crossorigin="anonymous"></script>
  </head>
  <body>
    <header>å®¶è¨ˆç®¡ç†ã‚¢ãƒ—ãƒª</header>
    <main>
      <div id="navi">
        <a href="credit.html"><span class="icon fa-solid fa-pen"></span>æ”¯æ‰•ç™»éŒ²</a>
        <a href="recurring.html"><span class="icon fa-solid fa-calendar-days"></span>å®šæœŸæ”¯æ‰•ç™»éŒ²</a>
        <a href="summary.html"><span class="icon fa-solid fa-coins"></span>æœˆåˆ¥é›†è¨ˆ</a>
        <a href="history.html"><span class="icon fa-solid fa-list"></span>ç™»éŒ²å±¥æ­´</a>
        <a href="setting.html"><span class="icon fa-solid fa-credit-card"></span>ã‚«ãƒ¼ãƒ‰è¨­å®š</a>
        <a href="manage.html" class="nowMenuButton"><span class="icon fa-solid fa-gear"></span>åˆæœŸè¨­å®š</a>
      </div>
      <section>
        <h2>æ”¯æ‰•ç™»éŒ²ãƒ•ã‚©ãƒ¼ãƒ </h2>
        <button onclick="fetchSpreadsheetList()" class="manageButton">ğŸ“„ ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆä¸€è¦§</button>
        <button onclick="createSpreadsheet()" class="manageButton">ğŸ†• æ–°è¦ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆï¼šã€Œå®¶è¨ˆç®¡ç†ã‚¢ãƒ—ãƒªã€ã‚’ä½œæˆ</button>

        <div class="currentId">ç¾åœ¨ã®ç´ã¥ã‘ID: <span id="spreadsheet-id">èª­ã¿è¾¼ã¿ä¸­...</span></div>

        <table id="sheet-list" style="display:none;">
          <thead>
            <tr>
              <th>åå‰</th>
              <th>URL</th>
              <th>æ“ä½œ</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </section>
    </main>
    
    <script>
      const GAS_URL = "https://script.google.com/macros/s/AKfycbx-wXtw54xG7xKPtzVNQqQidQUlc4ehwKDP0Ixi8qdz58_N5uy3x0xH9RKQohbGb_OT/exec";

      async function getCurrentId() {
        const res = await fetch(`${GAS_URL}?mode=currentId`);
        const text = await res.text();
        document.getElementById("spreadsheet-id").textContent = text || "(æœªè¨­å®š)";
      }

      async function fetchSpreadsheetList() {
        const res = await fetch(`${GAS_URL}?mode=listSheets`);
        const data = await res.json();
        const tbody = document.querySelector("#sheet-list tbody");
        tbody.innerHTML = "";

        data.forEach(file => {
          const tr = document.createElement("tr");
          tr.innerHTML = `
            <td>${file.name}</td>
            <td><a class="sheet-link" href="${file.url}" target="_blank">é–‹ã</a></td>
            <td><button onclick="selectSpreadsheet('${file.id}')">é¸æŠ</button></td>
          `;
          tbody.appendChild(tr);
        });

        document.getElementById("sheet-list").style.display = "table";
      }

      async function selectSpreadsheet(id) {
        const res = await fetch(`${GAS_URL}?mode=set&id=${id}`);
        const msg = await res.text();
        alert("é¸æŠä¿å­˜å®Œäº†: " + msg);
        getCurrentId();
      }

      async function createSpreadsheet() {
        const res = await fetch(`${GAS_URL}?mode=create`);
        const data = await res.json();
        alert(`ä½œæˆå®Œäº†: ${data.name}`);
        getCurrentId();
      }

      // åˆæœŸè¡¨ç¤º
      getCurrentId();
    </script>
  </body>
</html>
